{% extends "base.html" %}

{% block title %}茉莉花 - 音乐教学平台{% endblock %}

{% block content %}
    <main class="max-w-5xl mx-auto px-6 py-8">
        <div class="mb-8">
            <div class="flex items-center gap-2 text-sm mb-4 text-secondary">
                <a href="{{ url_for('index') }}" class="hover:underline">首页</a>
                <i class="fa-solid fa-chevron-right text-xs"></i>
                <span class="text-primary">茉莉花</span>
            </div>
            <h1 class="text-3xl font-medium mb-2 text-primary">茉莉花</h1>
            <p class="text-base text-secondary">中国民歌 · 江苏民间小调</p>
        </div>

        <div class="track-card p-6 mb-6">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-lg font-medium text-primary">播放控制</h2>
                <span class="status-tag ready"><i class="fa-solid fa-circle text-xs"></i>就绪</span>
            </div>
            <div class="flex items-center gap-4">
                <button class="btn-primary" onclick="playAll()"><i class="fa-solid fa-play mr-2"></i>全部播放</button>
                <button class="btn-secondary" onclick="pauseAll()"><i class="fa-solid fa-pause mr-2"></i>暂停</button>
                <button class="btn-secondary" onclick="restartAll()"><i class="fa-solid fa-rotate-right mr-2"></i>重新开始</button>
            </div>
        </div>

        <div class="track-card p-6 mb-4">
            <div class="flex items-start gap-4">
                <div class="icon-circle"><i class="fa-solid fa-music"></i></div>
                <div class="flex-1">
                    <div class="flex items-center justify-between mb-3">
                        <div>
                            <h3 class="font-medium text-base mb-1 text-primary">总音频</h3>
                            <p class="text-sm text-secondary">完整混音版本</p>
                        </div>
                    </div>
                    <audio id="total-audio" controls src="{{ url_for('assets', filename='audio/jasmine-flower.mp3') }}"></audio>
                </div>
            </div>
        </div>
    </main>

    <dialog id="score-dialog">
        <div class="dialog-header">
            <h3 id="score-title" class="font-medium text-lg text-primary">乐谱</h3>
            <button class="btn-icon" onclick="closeScoreViewer()"><i class="fa-solid fa-xmark"></i></button>
        </div>
        <div class="dialog-body">
            <iframe id="score-frame"></iframe>
        </div>
    </dialog>
{% endblock %}

{% block extra_js %}
    <script src="{{ url_for('static', filename='js/track-player.js') }}"></script>
    <script>
        initTrackPlayer(['total-audio']);

        function openScoreViewer(pdfUrl, title) {
            var dialog = document.getElementById('score-dialog');
            var titleEl = document.getElementById('score-title');
            var frame = document.getElementById('score-frame');
            if (titleEl) titleEl.textContent = title || '乐谱';
            if (frame) frame.src = pdfUrl;
            if (dialog) dialog.showModal();
        }

        function closeScoreViewer() {
            var dialog = document.getElementById('score-dialog');
            var frame = document.getElementById('score-frame');
            if (frame) frame.src = '';
            if (dialog) dialog.close();
        }
    </script>
{% endblock %}
